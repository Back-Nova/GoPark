<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jefe de Ventas | GoPark</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <div class="admin-bg">
    <header class="admin-header">
      <h1 class="admin-title"><i class="fa-solid fa-user-shield"></i> Jefe de Ventas GoPark</h1>
      <nav class="admin-nav">
        <a href="#paquetes" class="nav-link active"><i class="fa-solid fa-box"></i> Paquetes</a>
      </nav>
    </header>

    <main class="admin-main">
      <!-- Paquetes -->
      <section id="paquetes" class="admin-section">
        <div class="section-header">
          <h2><i class="fa-solid fa-box"></i> Paquetes turísticos</h2>
          <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="admin-nuevo-btn" id="nuevoPaqueteBtn">
              <i class="fa-solid fa-plus"></i> Nuevo Paquete
            </button>
            <button class="admin-nuevo-btn" onclick="location.href='/recursos'">
              <i class="fa-solid fa-cubes"></i> Nuevo Recurso
            </button>
            <button class="admin-nuevo-btn" onclick="location.href='/pagina_destino'">
              <i class="fa-solid fa-map-location-dot"></i> Nuevo Destino
            </button>
          </div>
        </div>

        <!-- CONTENEDOR DEL FORMULARIO -->
        <div id="contenedorFormularioPaquete" style="margin-top: 1.5em; display: none;">
            <section class="admin-section" style="box-shadow: 0 0 32px #00f2ff77, 0 2px 12px #00f2ff33; border-radius: 14px; padding: 26px 8px;">
              <h2 style="color:#00f2ff; text-shadow:0 2px 18px #00f2ff55; display:flex; align-items:center; gap:10px; margin-bottom: 16px;">
                <i class="fa-solid fa-box-open"></i> Crear Nuevo Paquete
              </h2>
              <form id="formPaquete" class="destino-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px 26px; margin-top: 6px;">
                <div class="form-group">
                  <label for="nombre" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-signature"></i> Nombre
                  </label>
                  <input type="text" id="nombre" placeholder="Nombre del paquete" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group" style="grid-column: span 2;">
                  <label for="descripcion" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-align-left"></i> Descripción
                  </label>
                  <textarea id="descripcion" placeholder="Descripción del paquete" rows="3" required style="width:100%; padding:0px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px; resize:vertical;"></textarea>
                </div>

                <div class="form-group">
                  <label for="precio" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-dollar-sign"></i> Precio
                  </label>
                  <input type="number" id="precio" step="0.01" placeholder="999.99" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="cupos_totales" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-users"></i> Cupos Totales
                  </label>
                  <input type="number" id="cupos_totales" placeholder="Ej: 20" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="fecha_inicio" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-calendar-day"></i> Fecha Inicio
                  </label>
                  <input type="date" id="fecha_inicio" required style="width:100%; padding:0px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="fecha_fin" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-calendar-day"></i> Fecha Fin
                  </label>
                  <input type="date" id="fecha_fin" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="tipo" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-tag"></i> Tipo
                  </label>
                  <input type="text" id="tipo" placeholder="Ej: Familiar, Aventura" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="disponible" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-check"></i> Disponible
                  </label>
                  <select id="disponible" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                    <option value="true">&#10003; Sí</option>
                    <option value="false">&#10007; No</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="cupos_disponibles" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-users"></i> Cupos Disponibles
                  </label>
                  <input type="number" id="cupos_disponibles" placeholder="Ej: 10" required style="width:100%; padding:1px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                </div>

                <div class="form-group">
                  <label for="vuelo" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-plane"></i> Vuelo
                  </label>
                  <select id="vuelo" style="width:100%; padding:6px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                    <option value="">Seleccionar vuelo</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="vehiculo" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-car"></i> Vehículo
                  </label>
                  <select id="vehiculo" style="width:100%; padding:6px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                    <option value="">Seleccionar vehículo</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="alojamiento" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-hotel"></i> Alojamiento
                  </label>
                  <select id="alojamiento" style="width:100%; padding:6px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                    <option value="">Seleccionar alojamiento</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="excursion" style="color:#00f2ff; font-weight:700;">
                    <i class="fa-solid fa-person-hiking"></i> Excursión
                  </label>
                  <select id="excursion" style="width:100%; padding:6px; border-radius:8px; border:2px solid #00f2ff; background:#101c24; color:#eafcff; font-family:'Orbitron',Arial,sans-serif; font-size:1rem; margin-top:2px;">
                    <option value="">Seleccionar excursión</option>
                  </select>
                </div>

                <div style="grid-column: 1 / -1; display:flex; justify-content:flex-end; margin-top:16px;">
                  <button type="submit" style="padding:5px 27px; background:linear-gradient(90deg,#00f2ff 30%,#1b2326 100%); color:#071a1b; border:2px solid #00f2ff; border-radius:10px; font-family:'Orbitron',Arial,sans-serif; font-size:1.09rem; font-weight:900; letter-spacing:1px; cursor:pointer; box-shadow:0 0 18px #00f2ff66; transition:background 0.19s, color 0.19s, box-shadow 0.19s; display:flex; align-items:center; gap:10px;">
                    <i class="fa-solid fa-plus" id="btnCrearPaquete"></i> Crear Paquete
                  </button>
                </div>
              </form>
            </section>
        </div>

        <div class="admin-lista" id="paquetesLista"></div>

        <section id="listaPaquetes" class="admin-section" style="margin-top: 40px; padding: 12px;">
          <h2 style="color:#00f2ff; font-family:'Orbitron',Arial,sans-serif; font-size:1.4rem;">
            <i class="fa-solid fa-list"></i> Lista de Paquetes Creados
          </h2>
          <div id="lista-paquetes-contenedor" style="margin-top:20px; display: grid; gap: 20px;"></div>
        </section>
      </section>
    </main>

    <footer class="admin-footer">
      Echo por alumnos E.E.T N°3139 Gral M Miguel De Guemes
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const formPaquete = document.getElementById("formPaquete");
  const contenedorFormulario = document.getElementById("contenedorFormularioPaquete");

  // Cargar todas las opciones para los selects
  async function cargarOpciones() {
    console.log("Cargando opciones para selects...");

    try {
      const [vuelosRes, vehiculosRes, alojamientosRes, excursionesRes] = await Promise.all([
        fetch("/api/vuelos"),
        fetch("/api/vehiculos"),
        fetch("/api/alojamientos"),
        fetch("/api/excursiones")
      ]);

      if (!vuelosRes.ok || !vehiculosRes.ok || !alojamientosRes.ok || !excursionesRes.ok) {
        console.warn("Algún fetch de opciones falló:",
          vuelosRes.status, vehiculosRes.status, alojamientosRes.status, excursionesRes.status);
        alert("❌ Error al cargar datos para los selects.");
        return;
      }

      const vuelos = await vuelosRes.json();
      const vehiculos = await vehiculosRes.json();
      const alojamientos = await alojamientosRes.json();
      const excursiones = await excursionesRes.json();

      console.log("Datos cargados:", { vuelos, vehiculos, alojamientos, excursiones });

      cargarSelect("vuelo", vuelos, "id_vuelo", "aerolinea");
      cargarSelect("vehiculo", vehiculos, "id_vehiculo", "modelo");
      cargarSelect("alojamiento", alojamientos, "id_alojamiento", "nombre");
      cargarSelect("excursion", excursiones, "id_excursion", "nombre");

    } catch (error) {
      console.error("Error al cargar opciones:", error);
      alert("❌ Error inesperado al cargar datos.");
    }
  }

  // Llenar un select con opciones
  function cargarSelect(selectId, datos, campoId, campoTexto) {
    const select = document.getElementById(selectId);
    select.innerHTML = '<option value="" style="color:#eafcff;">--Seleccione--</option>';

    datos.forEach(item => {
      const option = document.createElement("option");
      option.value = item[campoId];
      option.textContent = item[campoTexto];
      option.style.color = "#eafcff";
      select.appendChild(option);
    });
  }

  // Cargar y mostrar todos los paquetes existentes
  async function cargarPaquetes() {
    try {
      const res = await fetch("/api/paquetes");
      if (!res.ok) throw new Error("Error al obtener los paquetes");

      const paquetes = await res.json();
      const contenedor = document.getElementById("lista-paquetes-contenedor");
      contenedor.innerHTML = ""; // Limpiar lista anterior

      if (paquetes.length === 0) {
        contenedor.innerHTML = "<p style='color:#ccc;'>No hay paquetes cargados aún.</p>";
        return;
      }

      paquetes.forEach(p => {
        const tarjeta = document.createElement("div");
        tarjeta.style.background = "#06242c";
        tarjeta.style.border = "1px solid #00f2ff";
        tarjeta.style.borderRadius = "5px";
        tarjeta.style.padding = "8px";
        tarjeta.style.color = "#eafcff";
        tarjeta.style.boxShadow = "0 0 10px #00f2ff88";
        tarjeta.style.display = "flex";
        tarjeta.style.justifyContent = "space-between";
        tarjeta.style.alignItems = "center";

        tarjeta.innerHTML = `
          <div style="flex: 1;">
            <h3 style="margin-bottom: 8px; color:#00f2ff; font-family:'Orbitron',Arial,sans-serif;">
              <i class="fa-solid fa-box"></i> ${p.nombre}
            </h3>
            <div style="display: flex; flex-wrap: wrap; gap: 10px 30px;">
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-align-left"></i> Descripción:</span>
                <span style="color:#eafcff;">${p.descripcion}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-dollar-sign"></i> Precio:</span>
                <span style="color:#eafcff;">$${p.precio.toFixed(2)}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-users"></i> Cupos:</span>
                <span style="color:#eafcff;">${p.cupos_disponibles} / ${p.cupos_totales}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-calendar-day"></i> Fechas:</span>
                <span style="color:#eafcff;">
                  ${new Date(p.fecha_inicio).toLocaleDateString()} ➜ ${new Date(p.fecha_fin).toLocaleDateString()}
                </span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-tag"></i> Tipo:</span>
                <span style="color:#eafcff;">${p.tipo}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-check"></i> Disponible:</span>
                <span style="color:${p.disponible ? '#00ff99' : '#ff4f4f'}; font-weight:bold;">
                  ${p.disponible ? 'Si' : 'Sí'}
                </span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-plane"></i> Vuelo:</span>
                <span style="color:#eafcff;">${p.vuelo || '-'}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-car"></i> Vehículo:</span>
                <span style="color:#eafcff;">${p.vehiculo || '-'}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-hotel"></i> Alojamiento:</span>
                <span style="color:#eafcff;">${p.alojamiento || '-'}</span>
              </div>
              <div>
                <span style="color:#00f2ff;"><i class="fa-solid fa-person-hiking"></i> Excursión:</span>
                <span style="color:#eafcff;">${p.excursion || '-'}</span>
              </div>
            </div>
          </div>
          <button class="btn-eliminar" data-id="${p.id}" style="margin-left: 20px; padding:8px 14px; background:linear-gradient(90deg,#ff4f4f 60%,#a80000 100%); color:white; border:none; border-radius:7px; cursor:pointer; font-weight:700; box-shadow:0 0 8px #ff4f4f77;">
            <i class="fa-solid fa-trash"></i> Eliminar
          </button>
        `;

        contenedor.appendChild(tarjeta);
      });

      // Asociar eventos de eliminar a cada botón
      document.querySelectorAll(".btn-eliminar").forEach(boton => {
        boton.addEventListener("click", async () => {
          const id = boton.getAttribute("data-id");
          if (confirm("¿Estás seguro de que deseas eliminar este paquete?")) {
            const delRes = await fetch(`/api/paquetes/${id}`, { method: "DELETE" });
            if (delRes.ok) {
              alert("✅ Paquete eliminado con éxito");
              cargarPaquetes(); // recargar la lista
            } else {
              alert("❌ No se pudo eliminar el paquete");
            }
          }
        });
      });

    } catch (error) {
      console.error("Error al cargar paquetes:", error);
      alert("❌ Error al cargar la lista de paquetes");
    }
  }

  // Llamar al cargar todas las opciones
  cargarOpciones();

  // Llamar al cargar la lista de paquetes
  cargarPaquetes();

  formPaquete.addEventListener("submit", async (e) => {
    e.preventDefault();

    try {
      const paqueteData = {
        nombre: document.getElementById("nombre").value.trim(),
        descripcion: document.getElementById("descripcion").value.trim(),
        precio: parseFloat(document.getElementById("precio").value),
        cupos_totales: parseInt(document.getElementById("cupos_totales").value, 10),
        fecha_inicio: document.getElementById("fecha_inicio").value,
        fecha_fin: document.getElementById("fecha_fin").value,
        tipo: document.getElementById("tipo").value.trim(),
        disponible: document.getElementById("disponible").value === "true",
        cupos_disponibles: parseInt(document.getElementById("cupos_disponibles").value, 10),
        vuelo: document.getElementById("vuelo").value || null,
        vehiculo: document.getElementById("vehiculo").value || null,
        alojamiento: document.getElementById("alojamiento").value || null,
        excursion: document.getElementById("excursion").value || null,
      };

      console.log("Datos a enviar:", paqueteData);

      if (!paqueteData.nombre || !paqueteData.descripcion || isNaN(paqueteData.precio)) {
        alert("Por favor completa los campos obligatorios correctamente.");
        return;
      }

      const response = await fetch("/api/paquetes", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(paqueteData),
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => null);
        console.error("Error en la respuesta:", errorData || response.statusText);
        alert(`Error al crear paquete: ${errorData?.message || response.statusText}`);
        return;
      }

      const result = await response.json();
      console.log("Resultado exitoso:", result);

      alert("✅ Paquete creado con éxito");
      formPaquete.reset();
      contenedorFormulario.style.display = "none";
      cargarPaquetes(); // Recargar la lista al crear

    } catch (error) {
      console.error("Error en la petición:", error);
      alert("❌ Ocurrió un error al intentar crear el paquete.");
    }
  });

  // Mostrar el formulario cuando se presiona el botón "Nuevo Paquete"
  document.getElementById("nuevoPaqueteBtn").addEventListener("click", () => {
    contenedorFormulario.style.display = "block";
  });
});

  </script>
</body>
</html>
